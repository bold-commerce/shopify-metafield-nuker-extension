function startMetafieldNuker(){BOLD.metafieldNuker.startTime=Date.now(),BOLD.metafieldNuker.targetNamespace=document.querySelector("#namespace").value,console.log("Target Namespace: "+BOLD.metafieldNuker.targetNamespace),BOLD.metafieldNuker.loggingEnabled=document.querySelector("#logging").value,getProductCount()}function getProductCount(){BOLD.metafieldNuker.productCount=0,BOLD.metafieldNuker.variantCount=0;var e=new XMLHttpRequest;e.open("GET",location.origin+"/admin/products/count.json"),e.send(),e.onreadystatechange=function(t){if(2==e.readyState)console.log("Sending Request in progress");else if(3==e.readyState){if(200!=e.status)throw"Oops! Something happened getting the product count... Error: "+e.response;BOLD.metafieldNuker.productCount=JSON.parse(e.response).count,console.log("Found "+BOLD.metafieldNuker.productCount+" products on "+location.origin),BOLD.metafieldNuker.totalPages=1,BOLD.metafieldNuker.productCount>250&&(BOLD.metafieldNuker.totalPages=Math.ceil(BOLD.metafieldNuker.productCount/250)),BOLD.metafieldNuker.productList=[],BOLD.metafieldNuker.pageIndex=1,getProductsByPage(BOLD.metafieldNuker.pageIndex)}}}function getProductsByPage(){if(BOLD.metafieldNuker.pageIndex<=BOLD.metafieldNuker.totalPages){BOLD.metafieldNuker.totalPages>1?console.log("Grabbing products in blocks of 250 at a time - Page "+BOLD.metafieldNuker.pageIndex+"..."):console.log("Grabbing products...");var e=new XMLHttpRequest;e.open("GET",location.origin+"/admin/products.json?fields=id,variants&limit=250&page="+BOLD.metafieldNuker.pageIndex),e.setRequestHeader("data-type","json"),e.send(),e.onreadystatechange=function(){if(2==e.readyState)console.log("Sending Request in progress");else if(4==e.readyState){if(200!=e.status)throw"Oops! Something happened getting the product list... Error: "+e.response;for(var t=JSON.parse(e.response).products,n=0;n<t.length;n++){for(var r=[],a=0;a<t[n].variants.length;a++)r.push({id:t[n].variants[a].id}),BOLD.metafieldNuker.variantCount++;BOLD.metafieldNuker.productList.push({id:t[n].id,variants:r})}BOLD.metafieldNuker.pageIndex++,getProductsByPage(BOLD.metafieldNuker.pageIndex)}}}else console.log("MOVING ON!!!"),iterateProductsForMetafields()}function iterateProductsForMetafields(){for(var e=0;e<BOLD.metafieldNuker.productList.length;e++){checkProducts(e);for(var t=0;t<BOLD.metafieldNuker.productList[e].variants.length;t++)checkVariants(e,t)}console.log("  Finished requesting nuking for current application..."),houseKeeping()}function checkProducts(e){console.log("%c  Checking product ID: "+BOLD.metafieldNuker.productList[e].id+" for metafields in namespace: "+BOLD.metafieldNuker.targetNamespace+"- ("+(e+1)+"/"+BOLD.metafieldNuker.productList.length+")","background:green;color:white");var t=new XMLHttpRequest;t.open("GET",location.origin+"/admin/products/"+BOLD.metafieldNuker.productList[e].id+"/metafields.json?fields=id,namespace&limit=250"),t.setRequestHeader("data-type","json"),t.send(),t.onreadystatechange=function(){if(2==t.readyState);else if(4==t.readyState){if(200!=t.status)throw"Oops! Something happened getting the metafields for product ID: "+BOLD.metafieldNuker.productList[e].id+". Error: "+result.status+" ("+result.statusText+")";for(var n=JSON.parse(t.response).metafields,r=0;r<n.length;r++)-1!=n[r].namespace.indexOf(BOLD.metafieldNuker.targetNamespace)&&deleteMetafield("product",BOLD.metafieldNuker.productList[e].id,n[r].id)}}.bind(this)}function checkVariants(e,t){console.log("%c    Checking variant ID: "+BOLD.metafieldNuker.productList[e].variants[t].id+" for metafields in namespace: "+BOLD.metafieldNuker.targetNamespace+" - ("+(t+1)+"/"+BOLD.metafieldNuker.productList[e].variants.length+")","background:blue;color:white");var n=new XMLHttpRequest;n.open("GET",location.origin+"/admin/variants/"+BOLD.metafieldNuker.productList[e].variants[t].id+"/metafields.json?fields=id,namespace&limit=250"),n.setRequestHeader("data-type","json"),n.send(),n.onreadystatechange=function(){if(2==n.readyState);else if(4==n.readyState){if(200!=n.status)throw"Oops! Something happened getting the metafields for variant ID: "+BOLD.metafieldNuker.productList[e].variants[t].id+". Error: "+result.status+" ("+result.statusText+")";for(var r=JSON.parse(n.response).metafields,a=0;a<r.length;a++)-1!=r[a].namespace.indexOf(BOLD.metafieldNuker.targetNamespace)&&deleteMetafield("variant",BOLD.metafieldNuker.productList[e].variants[t].id,r[a].id)}}.bind(this)}function deleteMetafield(e,t,n){var r=null;if(!document.querySelector("meta[name=csrf-token]"))throw"Csrf meta tag element is non existant, either you're not on the 'All products' admin page or Shopify did a dumb";r=document.querySelector("meta[name=csrf-token]").getAttribute("content");var a=new XMLHttpRequest;a.open("DELETE","/admin/api/2019-07/products/"+t+"/metafields/"+n+".json"),a.setRequestHeader("x-csrf-token",r),a.send(),a.onreadystatechange=function(){if(2==a.readyState);else if(3==a.readyState){if(200!=a.status)throw"Oops! Something happened deleting the metafield... Error: "+result.status+" ("+result.statusText+")";console.log("%c      Nuked metafield ID "+n+' in namespace "'+BOLD.metafieldNuker.targetNamespace+'" for '+e+" ID: "+t,"background:darkred;color:white")}}}function houseKeeping(){BOLD.metafieldNuker.finishTime=Date.now();var e=(BOLD.metafieldNuker.finishTime-BOLD.metafieldNuker.startTime)/1e3;console.log("Finished checking "+BOLD.metafieldNuker.variantCount+" variants."),console.log("Job took "+e.toString().toElapsedTime()+" to complete.")}document.querySelector("html").classList.add("nukerJSoverride"),document.querySelector("body").innerHTML+='<div id="nukerJSbar" class="fadein"></div>',document.querySelector("#nukerJSbar").innerHTML+='<div class="wrapper clearfix"></div>',document.querySelector("#nukerJSbar .wrapper").innerHTML+='<ul id="nukerJSnav"></ul>',document.querySelector("#nukerJSnav").innerHTML+='<li><a id="bn_about">About Nuker</a></li>',document.querySelector("#nukerJSnav").innerHTML+='<li class="hidden"></li>',document.querySelector("#nukerJSnav").innerHTML+='<li><select id="ns-selector"></select></li>',document.querySelector("#ns-selector").innerHTML+='<option value="bold_measurement">Buy the Measurement</option>',document.querySelector("#ns-selector").innerHTML+='<option value="shappify_csp">Customer Pricing</option>',document.querySelector("#ns-selector").innerHTML+='<option value="csp">Customer Pricing (NEW)</option>',document.querySelector("#ns-selector").innerHTML+='<option value="bold_donation">Donations Manager</option>',document.querySelector("#ns-selector").innerHTML+='<option value="shappify_bundle">Product Bundles</option>',document.querySelector("#ns-selector").innerHTML+='<option value="inventory">Product Discount</option>',document.querySelector("#ns-selector").innerHTML+='<option value="shappify_qb">Quantity Breaks</option>',document.querySelector("#ns-selector").innerHTML+='<option value="bold_rp">Recurring Orders</option>',document.querySelector("#nukerJSnav").innerHTML+='<li><a id="bn_nuke">Nuke Metafields</a></li>',document.querySelector("#nukerJSnav").innerHTML+='<li><a id="bn_settings">Settings</a></li>',document.querySelector("#nukerJSnav").innerHTML+="<li></li>",document.querySelector("#nukerJSbar .wrapper").innerHTML+='<input type="hidden" id="namespace" value="bold_measurement">',document.querySelector("#nukerJSbar .wrapper").innerHTML+='<input type="hidden" id="logging" value="true">',document.querySelector("#ns-selector").addEventListener("change",function(){document.querySelector("#namespace").value=document.querySelector("#ns-selector").value}),document.querySelector("#bn_nuke").addEventListener("click",function(){startMetafieldNuker()}),String.prototype.toElapsedTime=function(){var e=parseInt(this,10),t=Math.floor(e/3600),n=Math.floor((e-3600*t)/60),r=e-3600*t-60*n,a=t+" hours, "+n+" minutes, "+r+" seconds";return a};var BOLD=BOLD||{};BOLD.metafieldNuker={startTime:null,finishTime:null,productCount:null,variantCount:null,targetNamespace:null,loggingEnabled:null,totalPages:null,productList:null,pageIndex:null};